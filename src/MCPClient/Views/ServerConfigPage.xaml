<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MCPClient.Views.ServerConfigPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent">

    <ScrollViewer Padding="32">
        <StackPanel Spacing="24" MaxWidth="900">
            <TextBlock Text="MCP Servers" Style="{StaticResource TitleTextBlockStyle}"/>
            
            <TextBlock TextWrapping="Wrap" Opacity="0.7">
                Configure MCP servers that provide tools for the AI assistant.
                Servers are spawned as child processes when you connect.
            </TextBlock>
            
            <!-- Server List -->
            <StackPanel Spacing="16">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="Add Server" Click="AddServer_Click"/>
                    <Button Content="Connect All" Click="ConnectAll_Click"/>
                    <Button Content="Disconnect All" Click="DisconnectAll_Click"/>
                </StackPanel>
                
                <ListView x:Name="ServersListView" SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="12" ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="16"/>
                                    <TextBlock Opacity="0.7" FontSize="12">
                                        <Run Text="{Binding Command}"/>
                                        <Run Text=" "/>
                                        <Run Text="{Binding Args, Converter={StaticResource ArgsToStringConverter}}"/>
                                    </TextBlock>
                                </StackPanel>
                                
                                <ToggleSwitch Grid.Column="1" 
                                              IsOn="{Binding Enabled, Mode=TwoWay}"
                                              OnContent="Enabled" 
                                              OffContent="Disabled"/>
                                
                                <Button Grid.Column="2" 
                                        Content="Connect" 
                                        Click="ConnectServer_Click"
                                        Tag="{Binding}"/>
                                
                                <Button Grid.Column="3" 
                                        Content="&#xE74D;" 
                                        FontFamily="Segoe MDL2 Assets"
                                        Click="RemoveServer_Click"
                                        Tag="{Binding}"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
            
            <!-- Connected Servers Status -->
            <StackPanel Spacing="8">
                <TextBlock Text="Connected Servers" Style="{StaticResource SubtitleTextBlockStyle}"/>
                <ListView x:Name="ConnectedServersListView" MaxHeight="200">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" Foreground="Green"/>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
            
            <!-- Add/Edit Server Form -->
            <StackPanel x:Name="ServerFormPanel"
                        Spacing="12" 
                        Visibility="Collapsed"
                        Padding="16"
                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        CornerRadius="8">
                
                <TextBlock Text="Server Configuration" Style="{StaticResource SubtitleTextBlockStyle}"/>
                
                <TextBox x:Name="ServerNameTextBox" 
                         Header="Name" 
                         PlaceholderText="my-server"/>
                
                <TextBox x:Name="CommandTextBox" 
                         Header="Command" 
                         PlaceholderText="npx"/>
                
                <TextBox x:Name="ArgsTextBox" 
                         Header="Arguments (one per line)" 
                         PlaceholderText="-y&#x0a;@modelcontextprotocol/server-filesystem&#x0a;C:\path"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         Height="100"/>
                
                <TextBox x:Name="EnvTextBox" 
                         Header="Environment Variables (KEY=VALUE, one per line)" 
                         PlaceholderText="API_KEY=xxx"
                         AcceptsReturn="True"
                         TextWrapping="Wrap"
                         Height="80"/>
                
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="Save Server" Click="SaveServer_Click"/>
                    <Button Content="Cancel" Click="CancelServer_Click"/>
                </StackPanel>
            </StackPanel>
            
            <!-- Save All -->
            <Button Content="Save Configuration" 
                    Style="{StaticResource AccentButtonStyle}"
                    Click="SaveConfig_Click"/>
            
            <InfoBar x:Name="StatusInfoBar" 
                     IsOpen="False"/>
        </StackPanel>
    </ScrollViewer>
</Page>
